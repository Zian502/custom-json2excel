!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).customJson2excel=e()}(this,function(){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function s(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r,a=!0,i=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return a=t.done,t},e:function(t){i=!0,r=t},f:function(){try{a||null==o.return||o.return()}finally{if(i)throw r}}}}return function(){function S(t){var e=t.data,n=void 0===e?[]:e,o=t.exportFields,r=void 0!==o&&o,a=t.fields,i=void 0!==a&&a,l=t.filters,c=void 0===l?[]:l,s=t.footer,f=void 0===s?[]:s,u=t.keyMap,h=void 0===u?{}:u,d=t.name,y=void 0===d?"excel":d,v=t.title,p=void 0===v?[]:v,m=t.type,b=void 0===m?"xls":m,x=t.onStart,k=void 0===x?function(){}:x,g=t.onSuccess,w=void 0===g?function(){}:g;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,S),this.data=n,this.exportFields=r,this.fields=i,this.filters=c,this.footer=f,this.keyMap=h,this.name=y,this.title=p,this.type=b,this.onStart=k,this.onSuccess=w}var t,e,n;return t=S,(e=[{key:"downloadFields",value:function(){return void 0!==this.fields?this.fields:void 0!==this.exportFields?this.exportFields:void 0}},{key:"toChsKeys",value:function(t,i){var l=this;return t.map(function(t){if(0===l.filters.length)for(var e in t)i.hasOwnProperty(e)&&(t[i[e]]=t[e],delete t[e]);else{var n,o=s(l.filters);try{for(o.s();!(n=o.n()).done;){var r=n.value;for(var a in delete t[r],t)i.hasOwnProperty(a)&&(t[i[a]]=t[a],delete t[a])}}catch(t){o.e(t)}finally{o.f()}}return t})}},{key:"generate",value:function(){if(this.data.length){this.onStart();var t=this.getProcessedJson(this.data,this.downloadFields());return 0!==Object.keys(this.keyMap).length&&this.keyMap instanceof Object&&(t=this.toChsKeys(t,this.keyMap)),"csv"==this.type?this.export(this.jsonToCSV(t),"".concat(this.name,".").concat(this.type),"application/csv"):this.export(this.jsonToXLS(t),"".concat(this.name,".").concat(this.type),"application/vnd.ms-excel")}}},{key:"download",value:function(t,e){var n=document.createElement("a"),o=window.URL.createObjectURL(t);n.href=o,n.setAttribute("download",e),n.innerHTML="downloading...",n.style.display="none",document.body.appendChild(n),setTimeout(function(){n.click(),document.body.removeChild(n),setTimeout(function(){self.URL.revokeObjectURL(n.href)},250)},66)}},{key:"export",value:function(o,r,a){var i=this;new Promise(function(t,e){var n=i.base64ToBlob(o,a);t(i.download(n,r))}).then(function(t){i.onSuccess()}).catch(function(t){})}},{key:"jsonToXLS",value:function(t){var o="<thead><tr>";if(0!=this.title.length){var e,n=s(this.title);try{for(n.s();!(e=n.n()).done;){var r=e.value;o+="<th colspan=".concat(r.colspan,">").concat(r.name)}}catch(t){n.e(t)}finally{n.f()}o+="<th></tr>"}for(var a in t[0])o+="<th>"+a+"</th>";if(o+="</tr></thead>",o+="<tbody>",t.map(function(t,e){for(var n in o+="<tbody><tr>",t)o+="<td>"+t[n]+"</td>";o+="</tr></tbody>"}),0!=this.footer.length){o+="<tfooter><tr>";var i,l=s(this.footer);try{for(l.s();!(i=l.n()).done;){var c=i.value;o+="<th colspan=".concat(c.colspan,">").concat(c.name)}}catch(t){l.e(t)}finally{l.f()}o+="<th></tr></tr></tfooter>"}return'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>${table}</table></body></html>'.replace("${table}",o)}},{key:"jsonToCSV",value:function(t){var o="";if(0!=this.title.length){var e,n=s(this.title);try{for(n.s();!(e=n.n()).done;){var r=e.value;o+="".concat(r.name)}}catch(t){n.e(t)}finally{n.f()}o+="\r\n"}for(var a in t[0])o+=a+",";if(o=o.slice(0,o.length-1),o+="\r\n",t.map(function(t){for(var e in t){var n=t[e]+"";n.match(/[,"\n]/)&&(n='"'+n.replace(/\"/g,'""')+'"'),o+=n+","}o=o.slice(0,o.length-1),o+="\r\n"}),0!=this.footer.length){var i,l=s(this.footer);try{for(l.s();!(i=l.n()).done;){var c=i.value;o+="".concat(c.name)}}catch(t){l.e(t)}finally{l.f()}o+="\r\n"}return o}},{key:"getProcessedJson",value:function(t,e){var a=this.getKeys(t,e),i=[],l=this;return t.map(function(t,e){var n={};for(var o in a){var r=a[o];n[o]=l.getNestedData(r,t)}i.push(n)}),i}},{key:"getKeys",value:function(t,e){if(e)return e;var n={};for(var o in t[0])n[o]=o;return n}},{key:"parseExtraData",value:function(t,e){var n="";if(Array.isArray(t))for(var o=0;o<t.length;o++)n+=e.replace("${data}",t[o]);else n+=e.replace("${data}",t);return n}},{key:"callItemCallback",value:function(t,e){return"object"===a(t)&&"function"==typeof t.callback?t.callback(e):e}},{key:"getNestedData",value:function(t,e){var n=null,o=("object"===a(t)?t.field:t).split(".");n=e[o[0]];for(var r=1;r<o.length;r++)n=n[o[r]];return n=null==(n=this.callItemCallback(t,n))?"":n}},{key:"base64ToBlob",value:function(t,e){for(var n=window.btoa(window.unescape(encodeURIComponent(t))),o=atob(n),r=o.length,a=new Uint8ClampedArray(r);r--;)a[r]=o.charCodeAt(r);return new Blob([a],{type:e})}}])&&o(t.prototype,e),n&&o(t,n),S}()});
